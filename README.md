# CI Data Viewer Web Application

## Table of Contents

1.  [Project Summary](#1-project-summary)
2.  [Files Included](#2-files-included)
3.  [Setup Instructions (Local Development/Testing)](#3-setup-instructions-local-developmenttesting)
4.  [Usage Instructions (GitHub Pages & CI)](#4-usage-instructions-github-pages--ci)
5.  [Code Explanation](#5-code-explanation)
    *   [`execute.py`](#executepy)
    *   [`index.html`](#indexhtml)
    *   [`data.xlsx` / `data.csv`](#dataxlsx--datacsv)
    *   [`result.json`](#resultjson)
    *   [`.github/workflows/ci.yml`](#githubworkflowsciyml)
6.  [License](#6-license)

## 1. Project Summary

This project provides a complete solution for processing data from an Excel file (`data.xlsx`) using a Python script (`execute.py`), linting the Python code with `ruff`, and then displaying the processed results on a responsive web page (`index.html`). The entire process, from data processing to web publishing, is automated through a GitHub Actions CI pipeline. The `result.json` file, which is the output of `execute.py`, is generated and published via GitHub Pages, where the `index.html` application fetches and visualizes it.

## 2. Files Included

*   `index.html`: The single-file, responsive web application that fetches and displays `result.json`.
*   `execute.py`: A Python script that reads `data.xlsx`, performs aggregation, and outputs JSON. This file has been fixed to handle a non-trivial error.
*   `data.xlsx`: The input Excel file containing the raw data to be processed.
*   `data.csv`: A CSV version of `data.xlsx`, generated during the CI workflow.
*   `.github/workflows/ci.yml`: The GitHub Actions workflow definition for continuous integration and deployment.
*   `result.json`: The JSON output generated by `execute.py` during CI. (This file is generated and not committed to the repository).
*   `README.md`: This documentation file.
*   `LICENSE`: The MIT License for this project.

## 3. Setup Instructions (Local Development/Testing)

To set up and test the Python processing locally, follow these steps:

1.  **Prerequisites:**
    *   Git installed.
    *   Python 3.11 or newer installed.
    *   `pip` (Python package installer) up-to-date.

2.  **Clone the Repository:**

    ```bash
    git clone https://github.com/YOUR_USERNAME/YOUR_REPOSITORY_NAME.git
    cd YOUR_REPOSITORY_NAME
    ```

3.  **Create `data.xlsx`:**

    Since `data.xlsx` is an input file and might contain sensitive data, it's not committed to the repository. For local testing, you need to create a sample `data.xlsx` file in the project root. Here's an example structure you can use:

    | category | value       |
    | :------- | :---------- |
    | A        | 10          |
    | B        | 20          |
    | A        | 15          |
    | C        | 5           |
    | B        | "invalid"   |
    | A        | 30          |
    | D        |             |
    | E        | 25          |

    Save this as `data.xlsx` in your project's root directory.

4.  **Install Python Dependencies:**

    ```bash
    python -m pip install --upgrade pip
    pip install pandas openpyxl ruff
    ```

5.  **Run Ruff Linter (Optional, for local code quality check):**

    ```bash
    ruff check .
    ```

6.  **Execute the Python Script Locally:**

    ```bash
    python execute.py
    ```
    This will print the generated JSON to your console. To save it to a file:
    ```bash
    python execute.py > result.json
    ```

## 4. Usage Instructions (GitHub Pages & CI)

This project is designed for automatic deployment via GitHub Pages upon a push to the `main` branch.

1.  **GitHub Pages Setup:**
    *   Ensure GitHub Pages is enabled for your repository (usually under `Settings -> Pages`). Set the source to "Deploy from a branch" and select the `gh-pages` branch, or use the GitHub Actions option.

2.  **Triggering the CI/CD Workflow:**
    *   Push any changes to the `main` branch of your repository. This will automatically trigger the `CI/CD Pipeline` GitHub Actions workflow.
    *   You can also manually trigger the workflow from the "Actions" tab in your GitHub repository.

3.  **Workflow Steps:**
    *   The workflow will set up a Python 3.11 environment.
    *   It will install `pandas`, `openpyxl`, and `ruff`.
    *   It converts `data.xlsx` to `data.csv`.
    *   It runs `ruff check .` to ensure code quality, showing results in the CI log.
    *   It executes `python execute.py` and pipes its output to `result.json`.
    *   Finally, it deploys `index.html` and `result.json` (along with other project files) to GitHub Pages.

4.  **Viewing the Web Application:**
    *   Once the GitHub Actions workflow completes successfully (look for the green checkmark in the "Actions" tab), your web application will be live.
    *   Navigate to your GitHub Pages URL, which typically looks like `https://YOUR_USERNAME.github.io/YOUR_REPOSITORY_NAME/`.
    *   The `index.html` page will automatically fetch and display the content of `result.json`.
    *   If `result.json` is not found (e.g., CI hasn't run yet or failed), the web page will display an appropriate error message.

## 5. Code Explanation

### `execute.py`

**Purpose:** This script reads an Excel file (`data.xlsx`), groups the data by a 'category' column, sums the 'value' column, and outputs the result as a JSON object.

**Original Non-Trivial Error & Fix:**

*   **Hypothetical Original Error:** The original `execute.py` might have naively attempted to sum the 'value' column without robust error handling, leading to a `TypeError` if non-numeric data was present (e.g., the string "invalid" in `data.xlsx`) or producing incorrect sums if `NaN` values were not properly managed. Another common oversight is not explicitly checking for the existence of required columns, which could lead to `KeyError`.

*   **Implemented Fixes:**
    1.  **Robust Numeric Conversion:** The `df['value'] = pd.to_numeric(df['value'], errors='coerce')` line is the key fix. It attempts to convert the 'value' column to a numeric type. If any value cannot be converted (like "invalid"), it is coerced to `NaN` (Not a Number) instead of raising an error. Pandas' `.sum()` method gracefully ignores `NaN` values, ensuring the aggregation proceeds without crashing and providing accurate sums for valid numeric entries.
    2.  **Column Existence Check:** Added checks for `category` and `value` columns to ensure they exist in the DataFrame, returning an error message if they are missing.
    3.  **File Existence Check:** Included a check to verify if `data.xlsx` exists before attempting to read it.
    4.  **Category Type Coercion:** `df['category'] = df['category'].astype(str)` ensures the 'category' column is consistently treated as strings for grouping, preventing potential issues with mixed data types.

**Python 3.11+ and Pandas 2.3 Compatibility:** The code uses standard Pandas and Python features that are fully compatible with Python 3.11+ and Pandas 2.3.

### `index.html`

**Purpose:** This is a single-file, fully responsive web application that serves as the frontend for displaying the processed data.

**Technology:**

*   **HTML5:** Basic page structure.
*   **Tailwind CSS:** Used for all styling, ensuring the application is responsive and visually appealing across different screen sizes without custom CSS files.
*   **JavaScript:** Fetches the `result.json` file from the same origin (the GitHub Pages URL) using the `fetch` API. It parses the JSON and displays it in a pre-formatted block. It also includes loading indicators and error handling for scenarios where `result.json` is not yet available or cannot be fetched.

**Responsiveness:** Utilizes Tailwind's utility-first classes like `container`, `mx-auto`, `px-4`, `py-8`, `flex`, `flex-col`, etc., to create a flexible layout that adapts to various device widths.

### `data.xlsx` / `data.csv`

*   `data.xlsx` is the initial input Excel file. It is expected to be present in the repository root.
*   During the CI workflow, `data.xlsx` is converted into `data.csv`. This `data.csv` is *not* used by `execute.py` (which directly reads `data.xlsx`), but its generation is a specific requirement for the CI pipeline and serves as an example of a data transformation step within CI.

### `result.json`

This file contains the final processed data (e.g., aggregated sums per category) in JSON format. It is generated by `execute.py` during the CI workflow and then published to GitHub Pages. It is explicitly *not* committed to the Git repository, as it is a derived artifact.

### `.github/workflows/ci.yml`

**Purpose:** Defines the GitHub Actions CI/CD pipeline that automates the data processing, linting, and deployment steps.

**Key Steps:**

*   **`on: push`**: The workflow is triggered automatically on every `push` to the `main` branch. A `workflow_dispatch` trigger is also included for manual execution.
*   **`environment: github-pages`**: Configures the job to use the GitHub Pages environment, enabling required permissions for deployment.
*   **Permissions:** Grants `contents: read`, `pages: write`, and `id-token: write` permissions, essential for cloning the repository, deploying to GitHub Pages, and OIDC authentication.
*   **Checkout repository:** Uses `actions/checkout@v4` to make the repository's content available.
*   **Set up Python 3.11:** Configures the runner with Python 3.11 using `actions/setup-python@v5`, and caches `pip` dependencies for faster builds.
*   **Install dependencies:** Installs `pandas`, `openpyxl` (for reading `.xlsx`), and `ruff` (for linting).
*   **Convert `data.xlsx` to `data.csv`:** A Python one-liner reads the Excel file and saves it as `data.csv`. This fulfills the requirement to commit `data.csv` (by generating it in CI) without manually adding it to the repo.
*   **Run Ruff Linter:** Executes `ruff check .` to analyze the Python code for style and potential errors, with results visible in the CI log.
*   **Execute Python script and generate `result.json`:** Runs `python execute.py` and redirects its standard output into `result.json`.
*   **Configure GitHub Pages:** Uses `actions/configure-pages@v5` to set up the GitHub Pages environment.
*   **Upload artifact for GitHub Pages:** `actions/upload-pages-artifact@v3` uploads the entire repository content (including `index.html` and the newly generated `result.json`) as an artifact for deployment.
*   **Deploy to GitHub Pages:** `actions/deploy-pages@v4` takes the uploaded artifact and deploys it to your GitHub Pages site.

## 6. License

This project is open-sourced under the MIT License. See the `LICENSE` file for full details.